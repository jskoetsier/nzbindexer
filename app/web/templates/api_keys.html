{% extends "base.html" %}

{% block title %}API Keys - {{ settings.PROJECT_NAME }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h2>API Keys</h2>
            <p class="text-muted">Manage your API keys for programmatic access to the indexer.</p>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Your API Key</h5>
                </div>
                <div class="card-body">
                    {% if user.api_key %}
                    <div class="alert alert-info">
                        <strong>API Key:</strong>
                        <code id="apiKey" class="user-select-all">{{ user.api_key }}</code>
                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard()">
                            <i class="bi bi-clipboard"></i> Copy
                        </button>
                    </div>
                    <div class="mt-3">
                        <form action="/api-keys/regenerate" method="post" onsubmit="return confirm('Are you sure you want to regenerate your API key? Your old key will stop working.');">
                            <button type="submit" class="btn btn-warning">
                                <i class="bi bi-arrow-clockwise"></i> Regenerate API Key
                            </button>
                        </form>
                    </div>
                    {% else %}
                    <p>You don't have an API key yet.</p>
                    <form action="/api-keys/generate" method="post">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-key"></i> Generate API Key
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">API Documentation</h5>
                </div>
                <div class="card-body">
                    <p>Use your API key to access the NZB Indexer API programmatically.</p>

                    <h6 class="mt-3">Authentication</h6>
                    <p>Include your API key in the request header:</p>
                    <pre><code>X-API-Key: YOUR_API_KEY</code></pre>

                    <h6 class="mt-3">API Endpoints</h6>
                    <ul>
                        <li><strong>Search Releases:</strong> <code>GET /api/v1/releases?search=query</code></li>
                        <li><strong>Get Release:</strong> <code>GET /api/v1/releases/{id}</code></li>
                        <li><strong>Download NZB:</strong> <code>GET /releases/{id}/download</code></li>
                        <li><strong>List Groups:</strong> <code>GET /api/v1/groups</code></li>
                        <li><strong>List Categories:</strong> <code>GET /api/v1/categories</code></li>
                    </ul>

                    <h6 class="mt-3">Example Request</h6>
                    <pre><code>curl -H "X-API-Key: YOUR_API_KEY" {{ request.url.scheme }}://{{ request.url.netloc }}/api/v1/releases?search=ubuntu</code></pre>

                    <div class="mt-3">
                        <a href="/api/v1/docs" class="btn btn-outline-primary" target="_blank">
                            <i class="bi bi-book"></i> Full API Documentation
                        </a>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">API Usage Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3>{{ user.api_requests }}</h3>
                                <p class="text-muted">Total Requests</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3>{{ user.api_requests_today }}</h3>
                                <p class="text-muted">Today's Requests</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h3>{{ user.api_requests_reset.strftime('%Y-%m-%d') if user.api_requests_reset else 'N/A' }}</h3>
                                <p class="text-muted">Counter Reset Date</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const apiKey = document.getElementById('apiKey').textContent;
    navigator.clipboard.writeText(apiKey).then(() => {
        alert('API key copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy:', err);
    });
}
</script>
{% endblock %}
